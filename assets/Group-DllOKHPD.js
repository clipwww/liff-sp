import{_ as L,r as n,o as a,c as h,g as i,a as r,w as l,F as B,d as C,e as p,b as u,t as f,f as w,M as G}from"./index-COOF5Zia.js";import{u as N,c as T,a as E}from"./turnip.svc-BuXB6dfM.js";import"./acnh.svc-CO3KZtm1.js";import"./firebase-LKY1-RY1.js";const x={props:{groupList:{type:Array,default(){return[]}}},data(){return{activeTab:"all",showEditor:!1,groupName:"",password:"",isPrivate:!1,showDialog:!1,group:{},joinPassword:""}},computed:{...G({isLoggedIn:"isLoggedIn",profile:"profile"}),filterGroupList(){switch(this.activeTab){case"all":return this.groupList;case"joined":return this.groupList.filter(t=>t.members.includes(this.profile.userId));case"notjoin":return this.groupList.filter(t=>!t.members.includes(this.profile.userId));default:return[]}}},watch:{showDialog(t){t||(this.joinPassword="",this.group={})}},methods:{async updateProfileByUserId(){try{await E(this.profile.userId,this.profile)}catch(t){}},async onSubmit(){try{await T({name:this.groupName,password:this.isPrivate?this.password:"",creatorId:this.profile.userId}),this.showEditor=!1,this.updateProfileByUserId()}catch(t){}},async goDetails(t){if(!t.members.includes(this.profile.userId)){this.group=t,this.showDialog=!0;return}this.$router.push({name:"TurnipGroupDetails",params:{id:t.id}})},async beforeClose(t,e){if(t==="cancel"){e();return}if(this.joinPassword!==this.group.password){this.$notify({type:"danger",message:"Oops... 密碼錯誤"}),e(!1);return}try{this.group.members.push(this.profile.userId),await N(this.group.id,{...this.group}),this.updateProfileByUserId(),e(),this.$router.push({name:"TurnipGroupDetails",params:{id:this.group.id}})}catch(g){e()}}}},S={class:"group"},q={class:"margin-bt-15"},F={class:"margin-r-10 little-text"},z={class:"margin-l-5"},A={class:"margin-r-15"},M={class:"padding-t-30"},O={class:"padding-a-15"},H={class:"padding-a-10 fs-14"};function J(t,e,g,K,s,d){const c=n("van-tab"),b=n("van-tabs"),v=n("van-icon"),_=n("van-tag"),y=n("van-cell"),V=n("van-cell-group"),I=n("van-divider"),m=n("van-field"),k=n("van-switch"),P=n("van-button"),U=n("van-form"),D=n("van-popup"),j=n("van-dialog");return a(),h("div",S,[i("div",q,[r(b,{modelValue:s.activeTab,"onUpdate:modelValue":e[0]||(e[0]=o=>s.activeTab=o),type:"card"},{default:l(()=>[r(c,{title:"全部",name:"all"}),r(c,{title:"已加入",name:"joined"}),r(c,{title:"未加入",name:"notjoin"})]),_:1},8,["modelValue"])]),r(V,null,{default:l(()=>[(a(!0),h(B,null,C(d.filterGroupList,o=>(a(),p(y,{key:o.id,title:o.name,center:"","is-link":"",clickable:"",onClick:Q=>d.goDetails(o)},{label:l(()=>[i("div",null,[i("span",F,f(o.password?"私密":"公開")+"群組",1),r(v,{name:"user-o"}),i("span",z,f(o.members.length),1)])]),icon:l(()=>[i("div",A,[o.members.includes(t.profile.userId)?(a(),p(_,{key:0,type:"success",plain:""},{default:l(()=>[...e[8]||(e[8]=[u(" 已加入 ",-1)])]),_:1})):(a(),p(_,{key:1,plain:""},{default:l(()=>[...e[9]||(e[9]=[u(" 未加入 ",-1)])]),_:1}))])]),_:2},1032,["title","onClick"]))),128))]),_:1}),i("div",{class:"plus-btn",onClick:e[1]||(e[1]=o=>s.showEditor=!0)},[r(v,{name:"plus"})]),r(D,{show:s.showEditor,"onUpdate:show":e[5]||(e[5]=o=>s.showEditor=o),position:"bottom",closeable:"",style:{height:"70%"}},{default:l(()=>[i("div",M,[r(I,null,{default:l(()=>[...e[10]||(e[10]=[u("建立群組",-1)])]),_:1}),r(U,{onSubmit:d.onSubmit},{default:l(()=>[r(m,{modelValue:s.groupName,"onUpdate:modelValue":e[2]||(e[2]=o=>s.groupName=o),name:"群組名稱",label:"群組名稱",placeholder:"請填寫群組名稱",rules:[{required:!0,message:"請填寫群組名稱"}]},null,8,["modelValue"]),r(m,{name:"switch",label:"私密群組"},{input:l(()=>[r(k,{modelValue:s.isPrivate,"onUpdate:modelValue":e[3]||(e[3]=o=>s.isPrivate=o),size:"20"},null,8,["modelValue"])]),_:1}),s.isPrivate?(a(),p(m,{key:0,modelValue:s.password,"onUpdate:modelValue":e[4]||(e[4]=o=>s.password=o),name:"群組密碼",label:"群組密碼",placeholder:"請填寫群組密碼",rules:[{required:!0,message:"請填寫群組密碼"}]},null,8,["modelValue"])):w("",!0),i("div",O,[r(P,{type:"primary",round:"",block:"","native-type":"submit"},{default:l(()=>[...e[11]||(e[11]=[u(" 送出 ",-1)])]),_:1})])]),_:1},8,["onSubmit"])])]),_:1},8,["show"]),r(j,{show:s.showDialog,"onUpdate:show":e[7]||(e[7]=o=>s.showDialog=o),"show-cancel-button":"","close-on-popstate":"","before-close":d.beforeClose},{title:l(()=>[...e[12]||(e[12]=[i("div",{class:"padding-a-10"}," 您不在群組內，是否要加入群組？ ",-1)])]),default:l(()=>[i("div",H,[u(" 群組名稱："+f(s.group.name)+" ",1),e[13]||(e[13]=i("br",null,null,-1)),e[14]||(e[14]=u("加入群組後菜價資訊將會公開分享給群組內成員。 ",-1))]),s.group.password?(a(),p(m,{key:0,modelValue:s.joinPassword,"onUpdate:modelValue":e[6]||(e[6]=o=>s.joinPassword=o),label:"群組密碼",placeholder:"請輸入群組密碼"},null,8,["modelValue"])):w("",!0)]),_:1},8,["show","before-close"])])}const Z=L(x,[["render",J],["__scopeId","data-v-af6530cc"]]);export{Z as default};
