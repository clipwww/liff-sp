import{K as P}from"./KomicaPostCell-BVdn-9KH.js";import"./acnh.svc-Dirrrzgx.js";import{_ as y,r as a,o as n,c as r,g as f,a as l,w as m,F as p,d,e as g,f as C}from"./index-D_e8FN_z.js";import{a as V}from"./komica.svc-C6hyQkTY.js";import"./firebase-LKY1-RY1.js";import{l as o}from"./index-C0sn0UrP.js";const b={components:{KomicaPostCell:P},beforeRouteLeave(s,t,c){s.name.includes("Details")?(o.setObj(`${this.$route.name}-items`,this.items),o.set(`${this.$route.name}-page`,this.page),o.set(`${this.$route.name}-finished`,this.isFinished)):(o.remove(`${this.$route.name}-items`),o.remove(`${this.$route.name}-page`),o.remove(`${this.$route.name}-finished`)),c()},data(){return{item:null,items:o.getObj(`${this.$route.name}-items`)||[],page:+o.get(`${this.$route.name}-page`)||1,isLoading:!1,isFinished:o.get(`${this.$route.name}-finished`)==="true",isRefreshing:!1,showPopup:!1}},computed:{komicaType(){switch(!0){case this.$route.name.includes("KomicaNew"):return"new";case this.$route.name.includes("KomicaLive"):return"live";default:return""}}},watch:{showPopup(s){s||(this.item=null)}},methods:{async getList(s=!1){s&&(this.items=[],this.page=1,this.isFinished=!1,this.isRefreshing=!1),this.isLoading=!0;const t=await V(this.komicaType,this.page);if(this.isLoading=!1,this.isRefreshing=!1,!t.success){this.isFinished=!0;return}this.page++,this.page>t.pages?.length&&(this.isFinished=!0),this.items=this.items.concat(t.items)},openPopup(s){this.item=s,this.showPopup=!0},goDetails(s){const t=this.komicaType==="new"?"KomicaNewDetails":"KomicaLiveDetails";this.$router.push({name:t,params:{id:s.id},query:{title:s.title}})}}},F={class:"list__container"},K={class:"list__content with-safe-area-inset-bottom"},R={key:0,class:"padding-t-15 padding-b-20"};function x(s,t,c,D,i,u){const _=a("van-skeleton"),v=a("van-cell"),h=a("KomicaPostCell"),w=a("van-list"),k=a("van-pull-refresh"),L=a("van-popup");return n(),r("div",F,[f("div",K,[l(k,{modelValue:i.isRefreshing,"onUpdate:modelValue":t[1]||(t[1]=e=>i.isRefreshing=e),"head-height":"150",onRefresh:t[2]||(t[2]=e=>u.getList(!0))},{default:m(()=>[l(w,{modelValue:i.isLoading,"onUpdate:modelValue":t[0]||(t[0]=e=>i.isLoading=e),finished:i.isFinished,"finished-text":"没有更多了","error-text":"Oops...發生錯誤",offset:"50",onLoad:u.getList},{loading:m(()=>[f("div",null,[(n(),r(p,null,d(2,e=>l(v,{key:e},{default:m(()=>[l(_,{class:"padding-bt-5 padding-lr-0",row:4,title:"",avatar:"","avatar-shape":"square","avatar-size":"90"})]),_:1})),64))])]),default:m(()=>[(n(!0),r(p,null,d(i.items,e=>(n(),g(h,{key:e.id,item:e,"show-preview-btn":"",ellipsis:"",onClick:$=>u.goDetails(e),onClickPreview:$=>u.openPopup(e)},null,8,["item","onClick","onClickPreview"]))),128))]),_:1},8,["modelValue","finished","onLoad"])]),_:1},8,["modelValue"])]),l(L,{show:i.showPopup,"onUpdate:show":t[3]||(t[3]=e=>i.showPopup=e),round:"",position:"bottom","close-on-popstate":"",style:{height:"80%"}},{default:m(()=>[i.item?(n(),r("div",R,[l(h,{item:i.item,"is-details":!0},null,8,["item"]),(n(!0),r(p,null,d(i.item.reply,e=>(n(),g(h,{key:e.id,item:e,"is-details":!0},null,8,["item"]))),128))])):C("",!0)]),_:1},8,["show"])])}const q=y(b,[["render",x]]);export{q as default};
