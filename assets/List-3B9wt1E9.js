import{_ as k}from"./isEqual-dCtc9qNw.js";import{_ as x,r as a,o as i,c as l,g as u,a as s,h as M,v as B,F as p,d as _,w as r,f,e as D,b as h,t as E,j as G}from"./index-D_e8FN_z.js";import{M as I}from"./MovieListCell-DBJMqGbm.js";import{m}from"./firebase-LKY1-RY1.js";import"./acnh.svc-Dirrrzgx.js";import{a as N,b as S}from"./movie.svc-DNHuent_.js";import"./isArrayLike-fL3jztxv.js";import"./_getTag-CGruzcuc.js";const q={components:{MovieListCell:I},data(){return{keyword:"",movies:[],moviesGroupByDate:[],activeTab:window.localStorage.getItem("movies-activeTab")||"list"}},computed:{filterMovies(){return this.movies?.filter(e=>this.keyword?e.name.includes(this.keyword):!0).map(e=>{let t={};return this.moviesGroupByDate?.forEach(v=>{v.movies?.forEach(d=>{d.id===e.id&&(t=d)})}),{...e,...t}})},filterMoviesGroupByDate(){return this.moviesGroupByDate?.map(e=>({...e,movies:e.movies.filter(t=>this.keyword?t.name.includes(this.keyword):!0).map(t=>{const v=this.movies?.find(d=>d.id===t.id);return{...t,...v}})}))},isListMode(){return this.activeTab==="list"},isGroupByDateMode(){return this.activeTab==="date"}},watch:{activeTab(e){window.localStorage.setItem("movies-activeTab",e)}},created(){m.child("movies").on("value",e=>{const t=e.val();t&&(this.movies=t.items)}),m.child("movies-group-by-date").on("value",e=>{const t=e.val();t&&(this.moviesGroupByDate=t.items)}),this.getMovies(),this.getMoviesGroupBtDate()},beforeUnmount(){m.child("movies").off(),m.child("movies-group-by-date").off()},methods:{async getMovies(){const e=await S();e.success&&(k(this.movies,e.items)||m.child("movies").set({items:e.items,dateCreated:+G()}))},async getMoviesGroupBtDate(){const e=await N();e.success&&(k(this.moviesGroupByDate,e.items)||m.child("movies-group-by-date").set({items:e.items,dateCreated:+G()}))}}},z={class:"movie-list"},U={class:"list__container"},F={key:0,class:"list__content with-safe-area-inset-bottom"},j={key:1,class:"list__content with-safe-area-inset-bottom"};function R(e,t,v,d,n,c){const V=a("van-search"),y=a("MovieListCell"),b=a("van-skeleton"),g=a("van-cell"),L=a("van-tag"),T=a("van-cell-group"),w=a("van-tabbar-item"),C=a("van-tabbar");return i(),l("div",z,[u("div",U,[s(V,{modelValue:n.keyword,"onUpdate:modelValue":t[0]||(t[0]=o=>n.keyword=o),modelModifiers:{trim:!0},placeholder:"請輸入關鍵字搜尋"},null,8,["modelValue"]),c.isListMode?(i(),l("div",F,[s(y,{items:c.filterMovies},null,8,["items"]),M(u("div",null,[(i(),l(p,null,_(5,o=>s(g,{key:o},{default:r(()=>[s(b,{class:"padding-bt-5 padding-lr-0",row:2,title:"",avatar:"","avatar-shape":"square","avatar-size":"80"})]),_:1})),64))],512),[[B,!n.movies.length]])])):f("",!0),c.isGroupByDateMode?(i(),l("div",j,[(i(!0),l(p,null,_(c.filterMoviesGroupByDate,o=>(i(),D(T,{key:o.releaseDate},{title:r(()=>[o.movies.length?(i(),D(L,{key:0,type:"primary",size:"large",plain:""},{default:r(()=>[h(E(o.releaseDate),1)]),_:2},1024)):f("",!0)]),default:r(()=>[s(y,{items:o.movies},null,8,["items"])]),_:2},1024))),128)),M(u("div",null,[(i(),l(p,null,_(5,o=>s(g,{key:o},{default:r(()=>[s(b,{class:"padding-bt-5 padding-lr-0",row:2,title:"",avatar:"","avatar-shape":"square","avatar-size":"80"})]),_:1})),64))],512),[[B,!n.moviesGroupByDate.length]])])):f("",!0)]),s(C,{modelValue:n.activeTab,"onUpdate:modelValue":t[1]||(t[1]=o=>n.activeTab=o),fixed:"","safe-area-inset-bottom":""},{default:r(()=>[s(w,{icon:"orders-o",name:"list"},{default:r(()=>[...t[2]||(t[2]=[h(" 快速瀏覽 ",-1)])]),_:1}),s(w,{icon:"calender-o",name:"date"},{default:r(()=>[...t[3]||(t[3]=[h(" 依照上映日 ",-1)])]),_:1})]),_:1},8,["modelValue"])])}const X=x(q,[["render",R]]);export{X as default};
