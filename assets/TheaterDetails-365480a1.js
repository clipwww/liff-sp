import{n as h,h as r}from"./index-9ce14ff3.js";import{_ as m}from"./isEqual-dd5b6f94.js";import{f as c}from"./movie.svc-6ae5847d.js";import{m as i}from"./firebase-9126a35c.js";import"./acnh.svc-20a56244.js";import"./_getTag-5c2352f3.js";import"./isArrayLike-0dd9eb15.js";const f={metaInfo(){return{title:this.$route.query.title||this.theaterInfo.name}},data(){return{theaterInfo:{},movies:[],date:r(),showCalendar:!1,isEmpty:!1}},computed:{theaterId(){return this.$route.params.id},cityId(){return this.$route.query.cityId},formatDate(){return this.date.format("YYYYMMDD")},maxDate(){return new Date(r().add(7,"day"))},isToday(){return r().isSame(this.date,"day")}},watch:{formatDate:{immediate:!0,handler(a,t){this.movies=[],i.child(`theater-${this.theaterId}-${t}`).off(),i.child(`theater-${this.theaterId}-${a}`).off(),i.child(`theater-${this.theaterId}-${this.formatDate}`).on("value",e=>{const s=e.val();s&&(this.theaterInfo=s.item,this.movies=s.items)})}},showCalendar:{immediate:!0,handler(a){var t,e;a||(e=(t=document.body)==null?void 0:t.classList)==null||e.remove("van-overflow-hidden")}}},created(){i.on("value",a=>{Object.keys(a.val()).filter(e=>e.includes("theater-")).forEach(e=>{const s=a.child(e).val();r().isAfter(s.dateCreated,"day")&&i.child(e).remove()})}),this.getTheaterById()},beforeUnmount(){i.child(`theater-${this.theaterId}-${this.formatDate}`).off(),i.off()},methods:{async getTheaterById(){this.isEmpty=!1;const a=await c(this.theaterId,this.cityId,this.formatDate);a.success&&(a.items.length||(this.isEmpty=!0),m(this.movies,a.items)||i.child(`theater-${this.theaterId}-${this.formatDate}`).set({item:a.item,items:a.items,dateCreated:+r()}))},onDateChange(a){this.date=r(a),this.showCalendar=!1,this.getTheaterById()},isExpired(a){return r().isAfter(r(a,"HH：mm"))},goMovie({id:a}){this.$router.push({name:"MovieDetails",params:{id:a}})}}};var v=function(){var t=this,e=t._self._c;return e("div",[e("van-panel",{attrs:{title:t.theaterInfo.name,desc:t.theaterInfo.address}},[e("div",{attrs:{slot:"footer"},slot:"footer"},[e("van-tag",{staticClass:"margin-r-5 margin-bt-5",attrs:{plain:""}},[t._v(" 營業時間 "+t._s(t.theaterInfo.openingHours)+" ")]),e("van-tag",{staticClass:"margin-r-5 margin-bt-5",attrs:{plain:""}},[t._v(" 電話 "+t._s(t.theaterInfo.telephone)+" ")]),e("a",{staticClass:"margin-bt-5",attrs:{href:t.theaterInfo.url,target:"_blank"}},[e("van-tag",{attrs:{plain:""}},[t._v("網站")])],1)],1)]),e("van-cell",{staticClass:"margin-t-5",attrs:{value:t.formatDate,"is-link":""},on:{click:function(s){t.showCalendar=!0}}}),e("van-calendar",{attrs:{"show-confirm":!1,"max-date":t.maxDate,"close-on-popstate":""},on:{confirm:t.onDateChange},model:{value:t.showCalendar,callback:function(s){t.showCalendar=s},expression:"showCalendar"}}),t._l(t.movies,function(s){return e("van-card",{key:s.id,attrs:{title:s.title},on:{"click-thumb":function(n){return t.goMovie(s)}}},[e("div",{attrs:{slot:"thumb"},slot:"thumb"},[e("van-image",{attrs:{height:"88",fit:"cover",src:s.image,"lazy-load":""}}),e("div",{staticClass:"margin-t-5"},[e("van-image",{staticClass:"square",attrs:{width:"35",fit:"contain",src:s.cerImg,"lazy-load":""}})],1)],1),e("div",{attrs:{slot:"desc"},slot:"desc"},[e("div",[t._v("片長: "+t._s(s.runtime)+" 分")]),t._l(s.versions,function(n,l){return e("div",{key:l},[e("van-divider",{attrs:{"content-position":"left"}},[t._v(" "+t._s(n.name||"數位")+" ")]),t._l(n.times,function(o,d){return e("van-tag",{key:d,staticClass:"margin-a-5",attrs:{type:t.isExpired(o)?"default":"success",plain:""}},[t._v(" "+t._s(o)+" ")])})],2)})],2)])}),!t.movies.length&&!t.isEmpty?t._l(3,function(s){return e("van-card",{key:s},[e("van-skeleton",{attrs:{slot:"desc",title:"",avatar:"","avatar-size":"88px","avatar-shape":"square",row:3},slot:"desc"})],1)}):t._e()],2)},u=[],_=h(f,v,u,!1,null,"bf18f249",null,null);const w=_.exports;export{w as default};
