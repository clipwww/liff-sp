import{g as ee,h as re,m as te,n as ae}from"./index-71d8585f.js";import{e as ne,k as M,h as k,j as se,l as F,m as oe,n as ie,s as le,o as ce,a as ue,d as _,p as D,q as K,c as pe,i as fe,b as ge,g as ye}from"./_getTag-604f503c.js";import{_ as ve,T as be,a as de}from"./TurnipSellPrice-02d0c279.js";import{a as h,b as me,c as _e,_ as he,i as N}from"./isArrayLike-e2a72aad.js";import{l as $e,r as Ae,a as I,b as Te}from"./turnip.svc-f76d0fd1.js";import"./acnh.svc-a593798b.js";import{m as V,c as we}from"./index-899719e6.js";import"./firebase-b7fcb020.js";function Ie(e,r){for(var t=-1,a=e==null?0:e.length;++t<a&&r(e[t],t,e)!==!1;);return e}var Pe=Ie,P=ve;function je(e,r,t){r=="__proto__"&&P?P(e,r,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[r]=t}var R=je,Oe=R,Se=ne,Ce=Object.prototype,Le=Ce.hasOwnProperty;function Ee(e,r,t){var a=e[r];(!(Le.call(e,r)&&Se(a,t))||t===void 0&&!(r in e))&&Oe(e,r,t)}var q=Ee,xe=q,Be=R;function Ue(e,r,t,a){var l=!t;t||(t={});for(var o=-1,s=r.length;++o<s;){var i=r[o],c=a?a(t[i],e[i],i,t,e):void 0;c===void 0&&(c=e[i]),l?Be(t,i,c):xe(t,i,c)}return t}var m=Ue,Ge=m,Me=M;function ke(e,r){return e&&Ge(r,Me(r),e)}var Fe=ke;function De(e){var r=[];if(e!=null)for(var t in Object(e))r.push(t);return r}var Ke=De,Ne=h,Ve=k,Re=Ke,qe=Object.prototype,ze=qe.hasOwnProperty;function We(e){if(!Ne(e))return Re(e);var r=Ve(e),t=[];for(var a in e)a=="constructor"&&(r||!ze.call(e,a))||t.push(a);return t}var Ye=We,He=se,Je=Ye,Qe=me;function Xe(e){return Qe(e)?He(e,!0):Je(e)}var $=Xe,Ze=m,er=$;function rr(e,r){return e&&Ze(r,er(r),e)}var tr=rr,d={exports:{}};d.exports;(function(e,r){var t=_e,a=r&&!r.nodeType&&r,l=a&&!0&&e&&!e.nodeType&&e,o=l&&l.exports===a,s=o?t.Buffer:void 0,i=s?s.allocUnsafe:void 0;function c(g,v){if(v)return g.slice();var u=g.length,y=i?i(u):new g.constructor(u);return g.copy(y),y}e.exports=c})(d,d.exports);var ar=d.exports;function nr(e,r){var t=-1,a=e.length;for(r||(r=Array(a));++t<a;)r[t]=e[t];return r}var sr=nr,or=m,ir=F;function lr(e,r){return or(e,ir(e),r)}var cr=lr,ur=oe,pr=ur(Object.getPrototypeOf,Object),z=pr,fr=ie,gr=z,yr=F,vr=le,br=Object.getOwnPropertySymbols,dr=br?function(e){for(var r=[];e;)fr(r,yr(e)),e=gr(e);return r}:vr,W=dr,mr=m,_r=W;function hr(e,r){return mr(e,_r(e),r)}var $r=hr,Ar=ce,Tr=W,wr=$;function Ir(e){return Ar(e,wr,Tr)}var Pr=Ir,jr=Object.prototype,Or=jr.hasOwnProperty;function Sr(e){var r=e.length,t=new e.constructor(r);return r&&typeof e[0]=="string"&&Or.call(e,"index")&&(t.index=e.index,t.input=e.input),t}var Cr=Sr,j=ue;function Lr(e){var r=new e.constructor(e.byteLength);return new j(r).set(new j(e)),r}var A=Lr,Er=A;function xr(e,r){var t=r?Er(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}var Br=xr,Ur=/\w*$/;function Gr(e){var r=new e.constructor(e.source,Ur.exec(e));return r.lastIndex=e.lastIndex,r}var Mr=Gr,O=he,S=O?O.prototype:void 0,C=S?S.valueOf:void 0;function kr(e){return C?Object(C.call(e)):{}}var Fr=kr,Dr=A;function Kr(e,r){var t=r?Dr(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}var Nr=Kr,Vr=A,Rr=Br,qr=Mr,zr=Fr,Wr=Nr,Yr="[object Boolean]",Hr="[object Date]",Jr="[object Map]",Qr="[object Number]",Xr="[object RegExp]",Zr="[object Set]",et="[object String]",rt="[object Symbol]",tt="[object ArrayBuffer]",at="[object DataView]",nt="[object Float32Array]",st="[object Float64Array]",ot="[object Int8Array]",it="[object Int16Array]",lt="[object Int32Array]",ct="[object Uint8Array]",ut="[object Uint8ClampedArray]",pt="[object Uint16Array]",ft="[object Uint32Array]";function gt(e,r,t){var a=e.constructor;switch(r){case tt:return Vr(e);case Yr:case Hr:return new a(+e);case at:return Rr(e,t);case nt:case st:case ot:case it:case lt:case ct:case ut:case pt:case ft:return Wr(e,t);case Jr:return new a;case Qr:case et:return new a(e);case Xr:return qr(e);case Zr:return new a;case rt:return zr(e)}}var yt=gt,vt=h,L=Object.create,bt=function(){function e(){}return function(r){if(!vt(r))return{};if(L)return L(r);e.prototype=r;var t=new e;return e.prototype=void 0,t}}(),dt=bt,mt=dt,_t=z,ht=k;function $t(e){return typeof e.constructor=="function"&&!ht(e)?mt(_t(e)):{}}var At=$t,Tt=_,wt=N,It="[object Map]";function Pt(e){return wt(e)&&Tt(e)==It}var jt=Pt,Ot=jt,St=K,E=D,x=E&&E.isMap,Ct=x?St(x):Ot,Lt=Ct,Et=_,xt=N,Bt="[object Set]";function Ut(e){return xt(e)&&Et(e)==Bt}var Gt=Ut,Mt=Gt,kt=K,B=D,U=B&&B.isSet,Ft=U?kt(U):Mt,Dt=Ft,Kt=pe,Nt=Pe,Vt=q,Rt=Fe,qt=tr,zt=ar,Wt=sr,Yt=cr,Ht=$r,Jt=ge,Qt=Pr,Xt=_,Zt=Cr,ea=yt,ra=At,ta=ye,aa=fe,na=Lt,sa=h,oa=Dt,ia=M,la=$,ca=1,ua=2,pa=4,Y="[object Arguments]",fa="[object Array]",ga="[object Boolean]",ya="[object Date]",va="[object Error]",H="[object Function]",ba="[object GeneratorFunction]",da="[object Map]",ma="[object Number]",J="[object Object]",_a="[object RegExp]",ha="[object Set]",$a="[object String]",Aa="[object Symbol]",Ta="[object WeakMap]",wa="[object ArrayBuffer]",Ia="[object DataView]",Pa="[object Float32Array]",ja="[object Float64Array]",Oa="[object Int8Array]",Sa="[object Int16Array]",Ca="[object Int32Array]",La="[object Uint8Array]",Ea="[object Uint8ClampedArray]",xa="[object Uint16Array]",Ba="[object Uint32Array]",n={};n[Y]=n[fa]=n[wa]=n[Ia]=n[ga]=n[ya]=n[Pa]=n[ja]=n[Oa]=n[Sa]=n[Ca]=n[da]=n[ma]=n[J]=n[_a]=n[ha]=n[$a]=n[Aa]=n[La]=n[Ea]=n[xa]=n[Ba]=!0;n[va]=n[H]=n[Ta]=!1;function b(e,r,t,a,l,o){var s,i=r&ca,c=r&ua,g=r&pa;if(t&&(s=l?t(e,a,l,o):t(e)),s!==void 0)return s;if(!sa(e))return e;var v=ta(e);if(v){if(s=Zt(e),!i)return Wt(e,s)}else{var u=Xt(e),y=u==H||u==ba;if(aa(e))return zt(e,i);if(u==J||u==Y||y&&!l){if(s=c||y?{}:ra(e),!i)return c?Ht(e,qt(s,e)):Yt(e,Rt(s,e))}else{if(!n[u])return l?e:{};s=ea(e,u,i)}}o||(o=new Kt);var T=o.get(e);if(T)return T;o.set(e,s),oa(e)?e.forEach(function(p){s.add(b(p,r,t,p,e,o))}):na(e)&&e.forEach(function(p,f){s.set(f,b(p,r,t,f,e,o))});var Z=g?c?Qt:Jt:c?la:ia,w=v?void 0:Z(e);return Nt(w||e,function(p,f){w&&(f=p,p=e[f]),Vt(s,f,b(p,r,t,f,e,o))}),s}var Ua=b,Ga=Ua,Ma=1,ka=4;function Fa(e){return Ga(e,Ma|ka)}var Da=Fa;const Ka=ee(Da);V.getWeekStart();const Q=V.getWeekdays(),G=re(),X={};Q.forEach(e=>{X[e.id]={am:"",pm:""}});const Na={metaInfo(){var e;return{title:this.$route.query.title||((e=this.group)==null?void 0:e.name)}},components:{TurnipLineChart:be,TurnipSellPrice:de},props:{userList:{type:Array,default(){return[]}},priceList:{type:Array,default(){return[]}}},data(){return{weekdays:Q,group:null,showEditor:!1,form:{groupName:"",isPrivate:!1,password:""}}},computed:{...te({isLoggedIn:"isLoggedIn",profile:"profile"}),groupId(){return this.$route.params.id},filterPriceList(){return this.userList.filter(e=>{var r,t;return(t=(r=this.group)==null?void 0:r.members)==null?void 0:t.includes(e.id)}).map(e=>({...this.priceList.find(t=>t.id===e.id)||{buyPrice:"",sellPrice:Ka(X)},profile:e})).sort((e,r)=>{try{const t=G.weekday();if(t<=0)return(+e.buyPrice||110)>(+r.buyPrice||110)?1:-1;const a=G.locale("en-us").format("a"),l=+(e==null?void 0:e.sellPrice[`w${t}`][a])||0,o=+(r==null?void 0:r.sellPrice[`w${t}`][a])||0;return l>o?-1:1}catch(t){return 1}})},isCreator(){var e;return((e=this.group)==null?void 0:e.creatorId)===this.profile.userId}},watch:{showEditor(e){this.form.groupName=this.group.name,this.form.isPrivate=!!this.group.password,this.form.password=this.group.password}},created(){$e(this.groupId,e=>{var r,t;this.group=e,(t=(r=this.group)==null?void 0:r.members)!=null&&t.includes(this.profile.userId)||this.$router.replace({name:"TurnipGroup"})})},beforeRouteLeave(e,r,t){Ae(this.groupId),t()},methods:{async removeMembers(e){try{await this.$dialog.confirm({title:"確定嗎？"});const r=this.group.members.filter(t=>t!==e);await I(this.groupId,{...this.group,members:r}),this.$notify({type:"success",message:"成功"})}catch(r){}},async onSubmit(){try{await I(this.groupId,{...this.group,name:this.form.groupName,password:this.form.isPrivate?this.form.password:""}),this.showEditor=!1,this.$notify({type:"success",message:"修改成功"})}catch(e){}},async removeGroup(){try{await this.$dialog.confirm({title:"注意，此動作無法復原",message:"確定要刪除群組？"}),await Te(this.groupId)}catch(e){}},copyLink(){we(`https://liff.line.me/1557984400-gjEoY0y1/liff-sp${this.$route.fullPath}`)&&this.$toast.success({message:"已複製群組網址",duration:700})}}};var Va=function(){var r=this,t=r._self._c;return t("div",[r.group?t("div",[t("van-cell",{staticClass:"margin-b-15",attrs:{title:r.group.name,border:!1,center:""}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("van-icon",{attrs:{name:"user-o"}}),t("span",{staticClass:"margin-l-5"},[r._v(r._s(r.group.members.length))])],1),t("div",{attrs:{slot:"right-icon"},slot:"right-icon"},[r.isCreator?t("van-button",{staticClass:"margin-r-5",attrs:{type:"info",size:"small"},on:{click:function(a){r.showEditor=!0}}},[r._v(" 編輯 ")]):t("van-button",{staticClass:"margin-r-5",attrs:{type:"danger",size:"mini"},on:{click:function(a){return r.removeMembers(r.profile.userId)}}},[r._v(" 退出 ")]),t("van-button",{staticClass:"padding-lr-5",attrs:{type:"primary",size:"mini",plain:""},on:{click:r.copyLink}},[r._v(" 複製網址 ")])],1)]),r._l(r.filterPriceList,function(a){return t("van-panel",{key:a.id,staticClass:"margin-b-15"},[t("van-cell",{attrs:{slot:"header"},slot:"header"},[a.profile.pictureUrl?t("van-image",{staticClass:"margin-r-15",attrs:{slot:"icon",src:a.profile.pictureUrl,width:"50",height:"50",round:"","lazy-load":""},slot:"icon"}):r._e(),t("div",{attrs:{slot:"title"},slot:"title"},[r._v(" "+r._s(a.profile.displayName)+" ")]),t("div",{staticClass:"little-text",attrs:{slot:"label"},slot:"label"},[r._v(" 買價："+r._s(a.buyPrice)+" ")]),r.isCreator&&a.id!==r.profile.userId?t("div",{attrs:{slot:"right-icon"},slot:"right-icon"},[t("van-button",{attrs:{type:"danger",size:"mini"},on:{click:function(l){return r.removeMembers(a.id)}}},[r._v(" 移出 ")])],1):r._e()],1),t("TurnipSellPrice",{attrs:{"sell-price":a.sellPrice}}),t("div",{staticClass:"padding-bt-10"},[t("TurnipLineChart",{attrs:{id:a.id,"buy-price":a.buyPrice,"sell-price":a.sellPrice}})],1)],1)}),t("van-popup",{style:{height:"70%"},attrs:{position:"bottom",closeable:""},model:{value:r.showEditor,callback:function(a){r.showEditor=a},expression:"showEditor"}},[t("div",{staticClass:"padding-a-10"},[t("van-button",{attrs:{type:"danger",size:"mini"},on:{click:r.removeGroup}},[r._v(" 刪除群組 ")])],1),t("div",[t("van-divider",[r._v("編輯群組")]),t("van-form",{on:{submit:r.onSubmit}},[t("van-field",{attrs:{name:"群組名稱",label:"群組名稱",placeholder:"請填寫群組名稱",rules:[{required:!0,message:"請填寫群組名稱"}]},model:{value:r.form.groupName,callback:function(a){r.$set(r.form,"groupName",a)},expression:"form.groupName"}}),t("van-field",{attrs:{name:"switch",label:"私密群組"},scopedSlots:r._u([{key:"input",fn:function(){return[t("van-switch",{attrs:{size:"20"},model:{value:r.form.isPrivate,callback:function(a){r.$set(r.form,"isPrivate",a)},expression:"form.isPrivate"}})]},proxy:!0}])}),r.form.isPrivate?t("van-field",{attrs:{name:"群組密碼",label:"群組密碼",placeholder:"請填寫群組密碼",rules:[{required:!0,message:"請填寫群組密碼"}]},model:{value:r.form.password,callback:function(a){r.$set(r.form,"password",a)},expression:"form.password"}}):r._e(),t("div",{staticClass:"padding-a-15"},[t("van-button",{attrs:{type:"primary",round:"",block:"","native-type":"submit"}},[r._v(" 送出 ")])],1)],1)],1)])],2):t("van-skeleton",{staticClass:"padding-bt-15",attrs:{title:"",avatar:"","avatar-size":"50",row:6,loading:!r.group}})],1)},Ra=[],qa=ae(Na,Va,Ra,!1,null,"20b09687",null,null);const en=qa.exports;export{en as default};
