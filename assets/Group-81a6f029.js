import{m as r,n as i}from"./index-71d8585f.js";import{u as o,c as l,a as n}from"./turnip.svc-f76d0fd1.js";import"./acnh.svc-a593798b.js";import"./firebase-b7fcb020.js";const u={props:{groupList:{type:Array,default(){return[]}}},data(){return{activeTab:"all",showEditor:!1,groupName:"",password:"",isPrivate:!1,showDialog:!1,group:{},joinPassword:""}},computed:{...r({isLoggedIn:"isLoggedIn",profile:"profile"}),filterGroupList(){switch(this.activeTab){case"all":return this.groupList;case"joined":return this.groupList.filter(a=>a.members.includes(this.profile.userId));case"notjoin":return this.groupList.filter(a=>!a.members.includes(this.profile.userId));default:return[]}}},watch:{showDialog(a){a||(this.joinPassword="",this.group={})}},methods:{async updateProfileByUserId(){try{await o(this.profile.userId,this.profile)}catch(a){}},async onSubmit(){try{await l({name:this.groupName,password:this.isPrivate?this.password:"",creatorId:this.profile.userId}),this.showEditor=!1,this.updateProfileByUserId()}catch(a){}},async goDetails(a){if(!a.members.includes(this.profile.userId)){this.group=a,this.showDialog=!0;return}this.$router.push({name:"TurnipGroupDetails",params:{id:a.id}})},async beforeClose(a,s){if(a==="cancel"){s();return}if(this.joinPassword!==this.group.password){this.$notify({type:"danger",message:"Oops... 密碼錯誤"}),s(!1);return}try{this.group.members.push(this.profile.userId),await n(this.group.id,{...this.group}),this.updateProfileByUserId(),s(),this.$router.push({name:"TurnipGroupDetails",params:{id:this.group.id}})}catch(t){s()}}}};var p=function(){var s=this,t=s._self._c;return t("div",{staticClass:"group"},[t("div",{staticClass:"margin-bt-15"},[t("van-tabs",{attrs:{type:"card"},model:{value:s.activeTab,callback:function(e){s.activeTab=e},expression:"activeTab"}},[t("van-tab",{attrs:{title:"全部",name:"all"}}),t("van-tab",{attrs:{title:"已加入",name:"joined"}}),t("van-tab",{attrs:{title:"未加入",name:"notjoin"}})],1)],1),t("van-cell-group",s._l(s.filterGroupList,function(e){return t("van-cell",{key:e.id,attrs:{title:e.name,center:"","is-link":"",clickable:""},on:{click:function(v){return s.goDetails(e)}}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("span",{staticClass:"margin-r-10 little-text"},[s._v(s._s(e.password?"私密":"公開")+"群組")]),t("van-icon",{attrs:{name:"user-o"}}),t("span",{staticClass:"margin-l-5"},[s._v(s._s(e.members.length))])],1),t("div",{staticClass:"margin-r-15",attrs:{slot:"icon"},slot:"icon"},[e.members.includes(s.profile.userId)?t("van-tag",{attrs:{type:"success",plain:""}},[s._v(" 已加入 ")]):t("van-tag",{attrs:{plain:""}},[s._v(" 未加入 ")])],1)])}),1),t("div",{staticClass:"plus-btn",on:{click:function(e){s.showEditor=!0}}},[t("van-icon",{attrs:{name:"plus"}})],1),t("van-popup",{style:{height:"70%"},attrs:{position:"bottom",closeable:""},model:{value:s.showEditor,callback:function(e){s.showEditor=e},expression:"showEditor"}},[t("div",{staticClass:"padding-t-30"},[t("van-divider",[s._v("建立群組")]),t("van-form",{on:{submit:s.onSubmit}},[t("van-field",{attrs:{name:"群組名稱",label:"群組名稱",placeholder:"請填寫群組名稱",rules:[{required:!0,message:"請填寫群組名稱"}]},model:{value:s.groupName,callback:function(e){s.groupName=e},expression:"groupName"}}),t("van-field",{attrs:{name:"switch",label:"私密群組"},scopedSlots:s._u([{key:"input",fn:function(){return[t("van-switch",{attrs:{size:"20"},model:{value:s.isPrivate,callback:function(e){s.isPrivate=e},expression:"isPrivate"}})]},proxy:!0}])}),s.isPrivate?t("van-field",{attrs:{name:"群組密碼",label:"群組密碼",placeholder:"請填寫群組密碼",rules:[{required:!0,message:"請填寫群組密碼"}]},model:{value:s.password,callback:function(e){s.password=e},expression:"password"}}):s._e(),t("div",{staticClass:"padding-a-15"},[t("van-button",{attrs:{type:"primary",round:"",block:"","native-type":"submit"}},[s._v(" 送出 ")])],1)],1)],1)]),t("van-dialog",{attrs:{"show-cancel-button":"","close-on-popstate":"","before-close":s.beforeClose},model:{value:s.showDialog,callback:function(e){s.showDialog=e},expression:"showDialog"}},[t("div",{staticClass:"padding-a-10",attrs:{slot:"title"},slot:"title"},[s._v(" 您不在群組內，是否要加入群組？ ")]),t("div",{staticClass:"padding-a-10 fs-14"},[s._v(" 群組名稱："+s._s(s.group.name)+" "),t("br"),s._v("加入群組後菜價資訊將會公開分享給群組內成員。 ")]),s.group.password?t("van-field",{attrs:{label:"群組密碼",placeholder:"請輸入群組密碼"},model:{value:s.joinPassword,callback:function(e){s.joinPassword=e},expression:"joinPassword"}}):s._e()],1)],1)},c=[],d=i(u,p,c,!1,null,"866b11a9",null,null);const b=d.exports;export{b as default};
