import{n as o}from"./index-71d8585f.js";import{a as r}from"./komica.svc-b9838ace.js";import"./firebase-b7fcb020.js";import"./acnh.svc-a593798b.js";import{l as a}from"./index-899719e6.js";import{K as l}from"./KomicaPostCell-45633006.js";const u={components:{KomicaPostCell:l},beforeRouteLeave(s,e,i){s.name.includes("Details")?(a.setObj(`${this.$route.name}-items`,this.items),a.set(`${this.$route.name}-page`,this.page),a.set(`${this.$route.name}-finished`,this.isFinished)):(a.remove(`${this.$route.name}-items`),a.remove(`${this.$route.name}-page`),a.remove(`${this.$route.name}-finished`)),i()},data(){return{item:null,items:a.getObj(`${this.$route.name}-items`)||[],page:+a.get(`${this.$route.name}-page`)||1,isLoading:!1,isFinished:a.get(`${this.$route.name}-finished`)==="true",isRefreshing:!1,showPopup:!1}},computed:{komicaType(){switch(!0){case this.$route.name.includes("KomicaNew"):return"new";case this.$route.name.includes("KomicaLive"):return"live";default:return""}}},watch:{showPopup(s){s||(this.item=null)}},methods:{async getList(s=!1){s&&(this.items=[],this.page=1,this.isFinished=!1,this.isRefreshing=!1),this.isLoading=!0;const e=await r(this.komicaType,this.page);if(this.isLoading=!1,this.isRefreshing=!1,!e.success){this.isFinished=!0;return}this.page++,this.page>e.pages.length&&(this.isFinished=!0),this.items=this.items.concat(e.items)},openPopup(s){this.item=s,this.showPopup=!0},goDetails(s){const e=this.komicaType==="new"?"KomicaNewDetails":"KomicaLiveDetails";this.$router.push({name:e,params:{id:s.id},query:{title:s.title}})}}};var h=function(){var e=this,i=e._self._c;return i("div",{staticClass:"list__container"},[i("div",{staticClass:"list__content with-safe-area-inset-bottom"},[i("van-pull-refresh",{attrs:{"head-height":"150"},on:{refresh:function(t){return e.getList(!0)}},model:{value:e.isRefreshing,callback:function(t){e.isRefreshing=t},expression:"isRefreshing"}},[i("van-list",{attrs:{finished:e.isFinished,"finished-text":"没有更多了","error-text":"Oops...發生錯誤",offset:"50"},on:{load:e.getList},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[i("div",{attrs:{slot:"loading"},slot:"loading"},e._l(2,function(t){return i("van-cell",{key:t},[i("van-skeleton",{staticClass:"padding-bt-5 padding-lr-0",attrs:{row:4,title:"",avatar:"","avatar-shape":"square","avatar-size":"90"}})],1)}),1),e._l(e.items,function(t){return i("KomicaPostCell",{key:t.id,attrs:{item:t,"show-preview-btn":"",ellipsis:""},on:{click:function(n){return e.goDetails(t)},"click-preview":function(n){return e.openPopup(t)}}})})],2)],1)],1),i("van-popup",{style:{height:"80%"},attrs:{round:"",position:"bottom","close-on-popstate":""},model:{value:e.showPopup,callback:function(t){e.showPopup=t},expression:"showPopup"}},[e.item?i("div",{staticClass:"padding-t-15 padding-b-20"},[i("KomicaPostCell",{attrs:{item:e.item,"is-details":!0}}),e._l(e.item.reply,function(t){return i("KomicaPostCell",{key:t.id,attrs:{item:t,"is-details":!0}})})],2):e._e()])],1)},c=[],m=o(u,h,c,!1,null,"ca184b33",null,null);const $=m.exports;export{$ as default};
