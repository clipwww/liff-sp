import{n as c,h as l}from"./index-71d8585f.js";import{_ as v}from"./isEqual-b2d67feb.js";import{a as m,b as d}from"./movie.svc-6f99d645.js";import{m as s}from"./firebase-b7fcb020.js";import"./acnh.svc-a593798b.js";import{M as u}from"./MovieListCell-79c1cd42.js";import"./_getTag-604f503c.js";import"./isArrayLike-e2a72aad.js";const f={components:{MovieListCell:u},data(){return{keyword:"",movies:[],moviesGroupByDate:[],activeTab:window.localStorage.getItem("movies-activeTab")||"list"}},computed:{filterMovies(){var a;return(a=this.movies)==null?void 0:a.filter(e=>this.keyword?e.name.includes(this.keyword):!0).map(e=>{var i;let t={};return(i=this.moviesGroupByDate)==null||i.forEach(o=>{var r;(r=o.movies)==null||r.forEach(n=>{n.id===e.id&&(t=n)})}),{...e,...t}})},filterMoviesGroupByDate(){var a;return(a=this.moviesGroupByDate)==null?void 0:a.map(e=>({...e,movies:e.movies.filter(t=>this.keyword?t.name.includes(this.keyword):!0).map(t=>{var o;const i=(o=this.movies)==null?void 0:o.find(r=>r.id===t.id);return{...t,...i}})}))},isListMode(){return this.activeTab==="list"},isGroupByDateMode(){return this.activeTab==="date"}},watch:{activeTab(a){window.localStorage.setItem("movies-activeTab",a)}},created(){s.child("movies").on("value",a=>{const e=a.val();e&&(this.movies=e.items)}),s.child("movies-group-by-date").on("value",a=>{const e=a.val();e&&(this.moviesGroupByDate=e.items)}),this.getMovies(),this.getMoviesGroupBtDate()},beforeUnmount(){s.child("movies").off(),s.child("movies-group-by-date").off()},methods:{async getMovies(){const a=await m();a.success&&(v(this.movies,a.items)||s.child("movies").set({items:a.items,dateCreated:+l()}))},async getMoviesGroupBtDate(){const a=await d();a.success&&(v(this.moviesGroupByDate,a.items)||s.child("movies-group-by-date").set({items:a.items,dateCreated:+l()}))}}};var p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"movie-list"},[t("div",{staticClass:"list__container"},[t("van-search",{attrs:{placeholder:"請輸入關鍵字搜尋"},model:{value:e.keyword,callback:function(i){e.keyword=typeof i=="string"?i.trim():i},expression:"keyword"}}),e.isListMode?t("div",{staticClass:"list__content with-safe-area-inset-bottom"},[t("MovieListCell",{attrs:{items:e.filterMovies}}),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.movies.length,expression:"!movies.length"}]},e._l(5,function(i){return t("van-cell",{key:i},[t("van-skeleton",{staticClass:"padding-bt-5 padding-lr-0",attrs:{row:2,title:"",avatar:"","avatar-shape":"square","avatar-size":"80"}})],1)}),1)],1):e._e(),e.isGroupByDateMode?t("div",{staticClass:"list__content with-safe-area-inset-bottom"},[e._l(e.filterMoviesGroupByDate,function(i){return t("van-cell-group",{key:i.releaseDate},[i.movies.length?t("van-tag",{attrs:{slot:"title",type:"primary",size:"large",plain:""},slot:"title"},[e._v(" "+e._s(i.releaseDate)+" ")]):e._e(),t("MovieListCell",{attrs:{items:i.movies}})],1)}),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.moviesGroupByDate.length,expression:"!moviesGroupByDate.length"}]},e._l(5,function(i){return t("van-cell",{key:i},[t("van-skeleton",{staticClass:"padding-bt-5 padding-lr-0",attrs:{row:2,title:"",avatar:"","avatar-shape":"square","avatar-size":"80"}})],1)}),1)],2):e._e()],1),t("van-tabbar",{attrs:{fixed:"","safe-area-inset-bottom":""},model:{value:e.activeTab,callback:function(i){e.activeTab=i},expression:"activeTab"}},[t("van-tabbar-item",{attrs:{icon:"orders-o",name:"list"}},[e._v(" 快速瀏覽 ")]),t("van-tabbar-item",{attrs:{icon:"calender-o",name:"date"}},[e._v(" 依照上映日 ")])],1)],1)},h=[],_=c(f,p,h,!1,null,"fc8ffec6",null,null);const G=_.exports;export{G as default};
