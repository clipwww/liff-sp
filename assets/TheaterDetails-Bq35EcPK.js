import{_ as N}from"./isEqual-dCtc9qNw.js";import{_ as V,r as o,o as i,c,a as s,w as l,g as f,b as v,t as _,F as g,d as y,e as D,f as Y,j as d}from"./index-D_e8FN_z.js";import{m as h}from"./firebase-LKY1-RY1.js";import"./acnh.svc-Dirrrzgx.js";import{f as $}from"./movie.svc-DNHuent_.js";import"./isArrayLike-fL3jztxv.js";import"./_getTag-CGruzcuc.js";const z={metaInfo(){return{title:this.$route.query.title||this.theaterInfo.name}},data(){return{theaterInfo:{},movies:[],date:d(),showCalendar:!1,isEmpty:!1}},computed:{theaterId(){return this.$route.params.id},cityId(){return this.$route.query.cityId},formatDate(){return this.date.format("YYYYMMDD")},maxDate(){return new Date(d().add(7,"day"))},isToday(){return d().isSame(this.date,"day")}},watch:{formatDate:{immediate:!0,handler(e,r){this.movies=[],h.child(`theater-${this.theaterId}-${r}`).off(),h.child(`theater-${this.theaterId}-${e}`).off(),h.child(`theater-${this.theaterId}-${this.formatDate}`).on("value",n=>{const m=n.val();m&&(this.theaterInfo=m.item,this.movies=m.items)})}},showCalendar:{immediate:!0,handler(e){e||document.body?.classList?.remove("van-overflow-hidden")}}},created(){h.on("value",e=>{Object.keys(e.val()).filter(n=>n.includes("theater-")).forEach(n=>{const m=e.child(n).val();d().isAfter(m.dateCreated,"day")&&h.child(n).remove()})}),this.getTheaterById()},beforeUnmount(){h.child(`theater-${this.theaterId}-${this.formatDate}`).off(),h.off()},methods:{async getTheaterById(){this.isEmpty=!1;const e=await $(this.theaterId,this.cityId,this.formatDate);e.success&&(e.items.length||(this.isEmpty=!0),N(this.movies,e.items)||h.child(`theater-${this.theaterId}-${this.formatDate}`).set({item:e.item,items:e.items,dateCreated:+d()}))},onDateChange(e){this.date=d(e),this.showCalendar=!1,this.getTheaterById()},isExpired(e){return d().isAfter(d(e,"HH：mm"))},goMovie({id:e}){this.$router.push({name:"MovieDetails",params:{id:e}})}}},H={slot:"footer"},j=["href"],A={slot:"thumb"},F={class:"margin-t-5"},L={slot:"desc"};function S(e,r,n,m,a,u){const p=o("van-tag"),x=o("van-panel"),b=o("van-cell"),E=o("van-calendar"),k=o("van-image"),T=o("van-divider"),w=o("van-card"),B=o("van-skeleton");return i(),c("div",null,[s(x,{title:a.theaterInfo.name,desc:a.theaterInfo.address},{default:l(()=>[f("div",H,[s(p,{plain:"",class:"margin-r-5 margin-bt-5"},{default:l(()=>[v(" 營業時間 "+_(a.theaterInfo.openingHours),1)]),_:1}),s(p,{plain:"",class:"margin-r-5 margin-bt-5"},{default:l(()=>[v(" 電話 "+_(a.theaterInfo.telephone),1)]),_:1}),f("a",{href:a.theaterInfo.url,class:"margin-bt-5",target:"_blank"},[s(p,{plain:""},{default:l(()=>[...r[2]||(r[2]=[v("網站",-1)])]),_:1})],8,j)])]),_:1},8,["title","desc"]),s(b,{class:"margin-t-5",value:u.formatDate,"is-link":"",onClick:r[0]||(r[0]=t=>a.showCalendar=!0)},null,8,["value"]),s(E,{show:a.showCalendar,"onUpdate:show":r[1]||(r[1]=t=>a.showCalendar=t),"show-confirm":!1,"max-date":u.maxDate,"close-on-popstate":"",onConfirm:u.onDateChange},null,8,["show","max-date","onConfirm"]),(i(!0),c(g,null,y(a.movies,t=>(i(),D(w,{key:t.id,title:t.title,onClickThumb:I=>u.goMovie(t)},{default:l(()=>[f("div",A,[s(k,{height:"88",fit:"cover",src:t.image,"lazy-load":""},null,8,["src"]),f("div",F,[s(k,{class:"square",width:"35",fit:"contain",src:t.cerImg,"lazy-load":""},null,8,["src"])])]),f("div",L,[f("div",null,"片長: "+_(t.runtime)+" 分",1),(i(!0),c(g,null,y(t.versions,(I,q)=>(i(),c("div",{key:q},[s(T,{"content-position":"left"},{default:l(()=>[v(_(I.name||"數位"),1)]),_:2},1024),(i(!0),c(g,null,y(I.times,(C,M)=>(i(),D(p,{key:M,class:"margin-a-5",type:u.isExpired(C)?"default":"success",plain:""},{default:l(()=>[v(_(C),1)]),_:2},1032,["type"]))),128))]))),128))])]),_:2},1032,["title","onClickThumb"]))),128)),!a.movies.length&&!a.isEmpty?(i(),c(g,{key:0},y(3,t=>s(w,{key:t},{default:l(()=>[s(B,{slot:"desc",title:"",avatar:"","avatar-size":"88px","avatar-shape":"square",row:3})]),_:1})),64)):Y("",!0)])}const Q=V(z,[["render",S],["__scopeId","data-v-cac5a8f4"]]);export{Q as default};
