import{_ as g}from"./isEqual-dCtc9qNw.js";import{_ as M,r as n,o as h,c as p,h as m,v as f,a as s,w as o,g as d,F as w,d as I,e as x,b as _,t as E,K as S,j as L,M as D}from"./index-D_e8FN_z.js";import{m as l}from"./firebase-LKY1-RY1.js";import"./acnh.svc-Dirrrzgx.js";import{d as B,e as U}from"./movie.svc-DNHuent_.js";import"./isArrayLike-fL3jztxv.js";import"./_getTag-CGruzcuc.js";const N={data(){return{cityId:window.localStorage.getItem("cityId")||"",citys:[],theaters:[],favoriteList:[],activeTab:window.localStorage.getItem("theaters-activeTab")||"search",keyword:"",isEmpty:!1}},computed:{...D({isLoggedIn:"isLoggedIn",profile:"profile"}),filterList(){return(this.isFavorteMode?this.favoriteList:this.theaters).filter(t=>this.keyword?t.name.includes(this.keyword):!0)},cityOptions(){return this.citys.map(t=>({text:t.name,value:t.id}))},isFavorteMode(){return this.activeTab==="favorite"}},watch:{cityId:{immediate:!0,handler(t){this.getTheaterList(),window.localStorage.setItem("cityId",t)}},activeTab(t){window.localStorage.setItem("theaters-activeTab",t)},isLoggedIn:{immediate:!0,handler(t){t&&this.getFavoriteTheaters()}}},created(){l.child("citys").on("value",t=>{const e=t.val();e&&e.items?.length&&(this.citys=e.items,this.cityId||(this.cityId=this.citys[0].id))}),this.getCityList()},beforeUnmount(){l.child("citys").off()},methods:{async getCityList(){const t=await U();t.success&&(g(this.citys,t.items)||l.child("citys").set({items:t.items,dateCreated:+L()}))},async getTheaterList(){if(!this.cityId)return;await l.child(`theaters-${this.cityId}`).once("value",e=>{const v=e.val();v&&(this.theaters=v.items)});const t=await B(this.cityId);t.success&&(g(this.theaters,t.items)||l.child(`theaters-${this.cityId}`).set({items:t.items,dateCreated:+L()}),this.theaters=t.items)},getFavoriteTheaters(){this.isLoggedIn&&(this.isEmpty=!1,l.child(`favorite-theaters-${this.profile.userId}`).once("value",t=>{const e=t.val();e&&e?.length&&(this.favoriteList=e||[]),this.filterList.length||(this.isEmpty=!0)}))},async toggleFavorite(t){if(!this.isLoggedIn){this.$toast.fail("必須要登入才可以使用唷！");return}this.favoriteList.find(e=>e.id===t.id)?this.favoriteList=this.favoriteList.filter(e=>e.id!==t.id):this.favoriteList.push(t),await l.child(`favorite-theaters-${this.profile.userId}`).set(this.favoriteList),this.getFavoriteTheaters()},isFavorite(t){return!!this.favoriteList.find(e=>e.id===t.id)},goDetails(t){this.$router.push({name:"MovieTheaterDetails",params:{id:t.id},query:{cityId:this.cityId,title:t.name}})}}},q={class:"list__container"},O={class:"list__content with-safe-area-inset-bottom"},j={class:"text-center"},G={class:"text-center"};function K(t,e,v,R,a,r){const k=n("van-dropdown-item"),b=n("van-dropdown-menu"),T=n("van-search"),u=n("van-icon"),c=n("van-cell"),F=n("van-skeleton"),y=n("van-tabbar-item"),V=n("van-tabbar");return h(),p("div",q,[m(s(b,{class:"dropdown"},{default:o(()=>[s(k,{modelValue:a.cityId,"onUpdate:modelValue":e[0]||(e[0]=i=>a.cityId=i),options:r.cityOptions,placeholder:"安安"},null,8,["modelValue","options"])]),_:1},512),[[f,!r.isFavorteMode]]),s(T,{modelValue:a.keyword,"onUpdate:modelValue":e[1]||(e[1]=i=>a.keyword=i),modelModifiers:{trim:!0},placeholder:"請輸入關鍵字篩選"},null,8,["modelValue"]),d("div",O,[(h(!0),p(w,null,I(r.filterList,i=>(h(),x(c,{key:i.id,"is-link":"",onClick:C=>r.goDetails(i)},{icon:o(()=>[s(u,{class:"lh-inherit margin-r-10",name:r.isFavorite(i)?"like":"like-o",color:"#f48fb1",onClick:S(C=>r.toggleFavorite(i),["stop"])},null,8,["name","onClick"])]),default:o(()=>[_(" "+E(i.name),1)]),_:2},1032,["onClick"]))),128)),m(d("div",null,[(h(),p(w,null,I(10,i=>s(c,{key:i},{default:o(()=>[s(F,{title:"",row:0})]),_:1})),64))],512),[[f,!a.theaters.length&&a.cityId]]),m(s(c,null,{default:o(()=>[d("div",j,[s(u,{class:"fs-30",name:"warning"}),e[3]||(e[3]=d("div",null,"必須要登入才可以使用「我的最愛」唷！",-1))])]),_:1},512),[[f,r.isFavorteMode&&!t.isLoggedIn]]),m(s(c,null,{default:o(()=>[d("div",G,[s(u,{class:"fs-30",name:"info"}),e[4]||(e[4]=d("div",null,"這裡還什麼都沒有",-1))])]),_:1},512),[[f,r.isFavorteMode&&a.isEmpty]])]),s(V,{modelValue:a.activeTab,"onUpdate:modelValue":e[2]||(e[2]=i=>a.activeTab=i),fixed:"","safe-area-inset-bottom":""},{default:o(()=>[s(y,{icon:"search",name:"search"},{default:o(()=>[...e[5]||(e[5]=[_(" 地區搜尋 ",-1)])]),_:1}),s(y,{icon:"like",name:"favorite"},{default:o(()=>[...e[6]||(e[6]=[_(" 我的最愛 ",-1)])]),_:1})]),_:1},8,["modelValue"])])}const X=M(N,[["render",K],["__scopeId","data-v-c40f2757"]]);export{X as default};
