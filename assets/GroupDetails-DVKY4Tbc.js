import{b as Oe,c as rn,d as nn,r as tn,a as _r,g as an}from"./isArrayLike-fL3jztxv.js";import{b as on,i as hr,j as qr,k as sn,l as Ar,m as un,n as ln,o as cn,p as fn,a as pn,e as Re,q as Ir,s as Tr,d as yn,c as gn,f as dn,h as bn}from"./_getTag-CGruzcuc.js";import{r as vn,T as mn,a as _n}from"./TurnipSellPrice-COlCPogn.js";import{_ as hn,r as m,o as h,c as W,e as E,a as g,w as p,g as q,b as C,t as Z,F as qn,d as An,f as $,M as In,j as Tn}from"./index-D_e8FN_z.js";import"./acnh.svc-Dirrrzgx.js";import{r as wn,u as Me,l as Sn,b as Cn}from"./turnip.svc-Dre4WWUB.js";import{c as jn,m as wr}from"./index-C0sn0UrP.js";import"./firebase-LKY1-RY1.js";var ee,De;function Pn(){if(De)return ee;De=1;function n(e,r){for(var t=-1,a=e==null?0:e.length;++t<a&&r(e[t],t,e)!==!1;);return e}return ee=n,ee}var re,Fe;function Sr(){if(Fe)return re;Fe=1;var n=vn();function e(r,t,a){t=="__proto__"&&n?n(r,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):r[t]=a}return re=e,re}var ne,Ge;function Cr(){if(Ge)return ne;Ge=1;var n=Sr(),e=on(),r=Object.prototype,t=r.hasOwnProperty;function a(i,s,f){var c=i[s];(!(t.call(i,s)&&e(c,f))||f===void 0&&!(s in i))&&n(i,s,f)}return ne=a,ne}var te,Ne;function Y(){if(Ne)return te;Ne=1;var n=Cr(),e=Sr();function r(t,a,i,s){var f=!i;i||(i={});for(var c=-1,y=a.length;++c<y;){var d=a[c],v=s?s(i[d],t[d],d,i,t):void 0;v===void 0&&(v=t[d]),f?e(i,d,v):n(i,d,v)}return i}return te=r,te}var ae,We;function On(){if(We)return ae;We=1;var n=Y(),e=hr();function r(t,a){return t&&n(a,e(a),t)}return ae=r,ae}var ie,Ye;function Rn(){if(Ye)return ie;Ye=1;function n(e){var r=[];if(e!=null)for(var t in Object(e))r.push(t);return r}return ie=n,ie}var oe,ze;function En(){if(ze)return oe;ze=1;var n=Oe(),e=qr(),r=Rn(),t=Object.prototype,a=t.hasOwnProperty;function i(s){if(!n(s))return r(s);var f=e(s),c=[];for(var y in s)y=="constructor"&&(f||!a.call(s,y))||c.push(y);return c}return oe=i,oe}var se,He;function Ee(){if(He)return se;He=1;var n=sn(),e=En(),r=rn();function t(a){return r(a)?n(a,!0):e(a)}return se=t,se}var ue,Je;function Ln(){if(Je)return ue;Je=1;var n=Y(),e=Ee();function r(t,a){return t&&n(a,e(a),t)}return ue=r,ue}var U={exports:{}};U.exports;var Qe;function Bn(){return Qe||(Qe=1,(function(n,e){var r=nn(),t=e&&!e.nodeType&&e,a=t&&!0&&n&&!n.nodeType&&n,i=a&&a.exports===t,s=i?r.Buffer:void 0,f=s?s.allocUnsafe:void 0;function c(y,d){if(d)return y.slice();var v=y.length,A=f?f(v):new y.constructor(v);return y.copy(A),A}n.exports=c})(U,U.exports)),U.exports}var le,Xe;function xn(){if(Xe)return le;Xe=1;function n(e,r){var t=-1,a=e.length;for(r||(r=Array(a));++t<a;)r[t]=e[t];return r}return le=n,le}var ce,Ze;function Vn(){if(Ze)return ce;Ze=1;var n=Y(),e=Ar();function r(t,a){return n(t,e(t),a)}return ce=r,ce}var fe,$e;function jr(){if($e)return fe;$e=1;var n=un(),e=n(Object.getPrototypeOf,Object);return fe=e,fe}var pe,er;function Pr(){if(er)return pe;er=1;var n=cn(),e=jr(),r=Ar(),t=ln(),a=Object.getOwnPropertySymbols,i=a?function(s){for(var f=[];s;)n(f,r(s)),s=e(s);return f}:t;return pe=i,pe}var ye,rr;function kn(){if(rr)return ye;rr=1;var n=Y(),e=Pr();function r(t,a){return n(t,e(t),a)}return ye=r,ye}var ge,nr;function Un(){if(nr)return ge;nr=1;var n=fn(),e=Pr(),r=Ee();function t(a){return n(a,r,e)}return ge=t,ge}var de,tr;function Kn(){if(tr)return de;tr=1;var n=Object.prototype,e=n.hasOwnProperty;function r(t){var a=t.length,i=new t.constructor(a);return a&&typeof t[0]=="string"&&e.call(t,"index")&&(i.index=t.index,i.input=t.input),i}return de=r,de}var be,ar;function Le(){if(ar)return be;ar=1;var n=pn();function e(r){var t=new r.constructor(r.byteLength);return new n(t).set(new n(r)),t}return be=e,be}var ve,ir;function Mn(){if(ir)return ve;ir=1;var n=Le();function e(r,t){var a=t?n(r.buffer):r.buffer;return new r.constructor(a,r.byteOffset,r.byteLength)}return ve=e,ve}var me,or;function Dn(){if(or)return me;or=1;var n=/\w*$/;function e(r){var t=new r.constructor(r.source,n.exec(r));return t.lastIndex=r.lastIndex,t}return me=e,me}var _e,sr;function Fn(){if(sr)return _e;sr=1;var n=tn(),e=n?n.prototype:void 0,r=e?e.valueOf:void 0;function t(a){return r?Object(r.call(a)):{}}return _e=t,_e}var he,ur;function Gn(){if(ur)return he;ur=1;var n=Le();function e(r,t){var a=t?n(r.buffer):r.buffer;return new r.constructor(a,r.byteOffset,r.length)}return he=e,he}var qe,lr;function Nn(){if(lr)return qe;lr=1;var n=Le(),e=Mn(),r=Dn(),t=Fn(),a=Gn(),i="[object Boolean]",s="[object Date]",f="[object Map]",c="[object Number]",y="[object RegExp]",d="[object Set]",v="[object String]",A="[object Symbol]",L="[object ArrayBuffer]",B="[object DataView]",w="[object Float32Array]",x="[object Float64Array]",V="[object Int8Array]",k="[object Int16Array]",l="[object Int32Array]",K="[object Uint8Array]",z="[object Uint8ClampedArray]",H="[object Uint16Array]",J="[object Uint32Array]";function Q(_,X,M){var j=_.constructor;switch(X){case L:return n(_);case i:case s:return new j(+_);case B:return e(_,M);case w:case x:case V:case k:case l:case K:case z:case H:case J:return a(_,M);case f:return new j;case c:case v:return new j(_);case y:return r(_);case d:return new j;case A:return t(_)}}return qe=Q,qe}var Ae,cr;function Wn(){if(cr)return Ae;cr=1;var n=Oe(),e=Object.create,r=(function(){function t(){}return function(a){if(!n(a))return{};if(e)return e(a);t.prototype=a;var i=new t;return t.prototype=void 0,i}})();return Ae=r,Ae}var Ie,fr;function Yn(){if(fr)return Ie;fr=1;var n=Wn(),e=jr(),r=qr();function t(a){return typeof a.constructor=="function"&&!r(a)?n(e(a)):{}}return Ie=t,Ie}var Te,pr;function zn(){if(pr)return Te;pr=1;var n=Re(),e=_r(),r="[object Map]";function t(a){return e(a)&&n(a)==r}return Te=t,Te}var we,yr;function Hn(){if(yr)return we;yr=1;var n=zn(),e=Tr(),r=Ir(),t=r&&r.isMap,a=t?e(t):n;return we=a,we}var Se,gr;function Jn(){if(gr)return Se;gr=1;var n=Re(),e=_r(),r="[object Set]";function t(a){return e(a)&&n(a)==r}return Se=t,Se}var Ce,dr;function Qn(){if(dr)return Ce;dr=1;var n=Jn(),e=Tr(),r=Ir(),t=r&&r.isSet,a=t?e(t):n;return Ce=a,Ce}var je,br;function Xn(){if(br)return je;br=1;var n=yn(),e=Pn(),r=Cr(),t=On(),a=Ln(),i=Bn(),s=xn(),f=Vn(),c=kn(),y=gn(),d=Un(),v=Re(),A=Kn(),L=Nn(),B=Yn(),w=bn(),x=dn(),V=Hn(),k=Oe(),l=Qn(),K=hr(),z=Ee(),H=1,J=2,Q=4,_="[object Arguments]",X="[object Array]",M="[object Boolean]",j="[object Date]",Er="[object Error]",Be="[object Function]",Lr="[object GeneratorFunction]",Br="[object Map]",xr="[object Number]",xe="[object Object]",Vr="[object RegExp]",kr="[object Set]",Ur="[object String]",Kr="[object Symbol]",Mr="[object WeakMap]",Dr="[object ArrayBuffer]",Fr="[object DataView]",Gr="[object Float32Array]",Nr="[object Float64Array]",Wr="[object Int8Array]",Yr="[object Int16Array]",zr="[object Int32Array]",Hr="[object Uint8Array]",Jr="[object Uint8ClampedArray]",Qr="[object Uint16Array]",Xr="[object Uint32Array]",u={};u[_]=u[X]=u[Dr]=u[Fr]=u[M]=u[j]=u[Gr]=u[Nr]=u[Wr]=u[Yr]=u[zr]=u[Br]=u[xr]=u[xe]=u[Vr]=u[kr]=u[Ur]=u[Kr]=u[Hr]=u[Jr]=u[Qr]=u[Xr]=!0,u[Er]=u[Be]=u[Mr]=!1;function D(o,P,O,Zr,F,I){var b,G=P&H,N=P&J,$r=P&Q;if(O&&(b=F?O(o,Zr,F,I):O(o)),b!==void 0)return b;if(!k(o))return o;var Ve=w(o);if(Ve){if(b=A(o),!G)return s(o,b)}else{var R=v(o),ke=R==Be||R==Lr;if(x(o))return i(o,G);if(R==xe||R==_||ke&&!F){if(b=N||ke?{}:B(o),!G)return N?c(o,a(b,o)):f(o,t(b,o))}else{if(!u[R])return F?o:{};b=L(o,R,G)}}I||(I=new n);var Ue=I.get(o);if(Ue)return Ue;I.set(o,b),l(o)?o.forEach(function(T){b.add(D(T,P,O,T,o,I))}):V(o)&&o.forEach(function(T,S){b.set(S,D(T,P,O,S,o,I))});var en=$r?N?d:y:N?z:K,Ke=Ve?void 0:en(o);return e(Ke||o,function(T,S){Ke&&(S=T,T=o[S]),r(b,S,D(T,P,O,S,o,I))}),b}return je=D,je}var Pe,vr;function Zn(){if(vr)return Pe;vr=1;var n=Xn(),e=1,r=4;function t(a){return n(a,e|r)}return Pe=t,Pe}var $n=Zn();const et=an($n);wr.getWeekStart();const Or=wr.getWeekdays(),mr=Tn(),Rr={};Or.forEach(n=>{Rr[n.id]={am:"",pm:""}});const rt={metaInfo(){return{title:this.$route.query.title||this.group?.name}},components:{TurnipLineChart:_n,TurnipSellPrice:mn},beforeRouteLeave(n,e,r){Cn(this.groupId),r()},props:{userList:{type:Array,default(){return[]}},priceList:{type:Array,default(){return[]}}},data(){return{weekdays:Or,group:null,showEditor:!1,form:{groupName:"",isPrivate:!1,password:""}}},computed:{...In({isLoggedIn:"isLoggedIn",profile:"profile"}),groupId(){return this.$route.params.id},filterPriceList(){return this.userList.filter(n=>this.group?.members?.includes(n.id)).map(n=>({...this.priceList.find(r=>r.id===n.id)||{buyPrice:"",sellPrice:et(Rr)},profile:n})).sort((n,e)=>{try{const r=mr.weekday();if(r<=0)return(+n.buyPrice||110)>(+e.buyPrice||110)?1:-1;const t=mr.locale("en-us").format("a"),a=+n?.sellPrice[`w${r}`][t]||0,i=+e?.sellPrice[`w${r}`][t]||0;return a>i?-1:1}catch(r){return 1}})},isCreator(){return this.group?.creatorId===this.profile.userId}},watch:{showEditor(n){this.form.groupName=this.group.name,this.form.isPrivate=!!this.group.password,this.form.password=this.group.password}},created(){Sn(this.groupId,n=>{this.group=n,this.group?.members?.includes(this.profile.userId)||this.$router.replace({name:"TurnipGroup"})})},methods:{async removeMembers(n){try{await this.$dialog.confirm({title:"確定嗎？"});const e=this.group.members.filter(r=>r!==n);await Me(this.groupId,{...this.group,members:e}),this.$notify({type:"success",message:"成功"})}catch(e){}},async onSubmit(){try{await Me(this.groupId,{...this.group,name:this.form.groupName,password:this.form.isPrivate?this.form.password:""}),this.showEditor=!1,this.$notify({type:"success",message:"修改成功"})}catch(n){}},async removeGroup(){try{await this.$dialog.confirm({title:"注意，此動作無法復原",message:"確定要刪除群組？"}),await wn(this.groupId)}catch(n){}},copyLink(){jn(`https://liff.line.me/1557984400-gjEoY0y1/liff-sp${this.$route.fullPath}`)&&this.$toast.success({message:"已複製群組網址",duration:700})}}},nt={key:1},tt={class:"margin-l-5"},at={class:"little-text"},it={key:0},ot={class:"padding-bt-10"},st={class:"padding-a-10"},ut={class:"padding-a-15"};function lt(n,e,r,t,a,i){const s=m("van-skeleton"),f=m("van-icon"),c=m("van-button"),y=m("van-cell"),d=m("van-image"),v=m("TurnipSellPrice"),A=m("TurnipLineChart"),L=m("van-panel"),B=m("van-divider"),w=m("van-field"),x=m("van-switch"),V=m("van-form"),k=m("van-popup");return h(),W("div",null,[a.group?(h(),W("div",nt,[g(y,{class:"margin-b-15",title:a.group.name,border:!1,center:""},{label:p(()=>[q("div",null,[g(f,{name:"user-o"}),q("span",tt,Z(a.group.members.length),1)])]),"right-icon":p(()=>[q("div",null,[i.isCreator?(h(),E(c,{key:0,class:"margin-r-5",type:"info",size:"small",onClick:e[0]||(e[0]=l=>a.showEditor=!0)},{default:p(()=>[...e[6]||(e[6]=[C(" 編輯 ",-1)])]),_:1})):(h(),E(c,{key:1,class:"margin-r-5",type:"danger",size:"mini",onClick:e[1]||(e[1]=l=>i.removeMembers(n.profile.userId))},{default:p(()=>[...e[7]||(e[7]=[C(" 退出 ",-1)])]),_:1})),g(c,{class:"padding-lr-5",type:"primary",size:"mini",plain:"",onClick:i.copyLink},{default:p(()=>[...e[8]||(e[8]=[C(" 複製網址 ",-1)])]),_:1},8,["onClick"])])]),_:1},8,["title"]),(h(!0),W(qn,null,An(i.filterPriceList,l=>(h(),E(L,{key:l.id,class:"margin-b-15"},{header:p(()=>[g(y,null,{icon:p(()=>[l.profile.pictureUrl?(h(),E(d,{key:0,class:"margin-r-15",src:l.profile.pictureUrl,width:"50",height:"50",round:"","lazy-load":""},null,8,["src"])):$("",!0)]),title:p(()=>[q("div",null,Z(l.profile.displayName),1)]),label:p(()=>[q("div",at," 買價："+Z(l.buyPrice),1)]),"right-icon":p(()=>[i.isCreator&&l.id!==n.profile.userId?(h(),W("div",it,[g(c,{type:"danger",size:"mini",onClick:K=>i.removeMembers(l.id)},{default:p(()=>[...e[9]||(e[9]=[C(" 移出 ",-1)])]),_:1},8,["onClick"])])):$("",!0)]),_:2},1024)]),default:p(()=>[g(v,{"sell-price":l.sellPrice},null,8,["sell-price"]),q("div",ot,[g(A,{id:l.id,"buy-price":l.buyPrice,"sell-price":l.sellPrice},null,8,["id","buy-price","sell-price"])])]),_:2},1024))),128)),g(k,{show:a.showEditor,"onUpdate:show":e[5]||(e[5]=l=>a.showEditor=l),position:"bottom",closeable:"",style:{height:"70%"}},{default:p(()=>[q("div",st,[g(c,{type:"danger",size:"mini",onClick:i.removeGroup},{default:p(()=>[...e[10]||(e[10]=[C(" 刪除群組 ",-1)])]),_:1},8,["onClick"])]),q("div",null,[g(B,null,{default:p(()=>[...e[11]||(e[11]=[C("編輯群組",-1)])]),_:1}),g(V,{onSubmit:i.onSubmit},{default:p(()=>[g(w,{modelValue:a.form.groupName,"onUpdate:modelValue":e[2]||(e[2]=l=>a.form.groupName=l),name:"群組名稱",label:"群組名稱",placeholder:"請填寫群組名稱",rules:[{required:!0,message:"請填寫群組名稱"}]},null,8,["modelValue"]),g(w,{name:"switch",label:"私密群組"},{input:p(()=>[g(x,{modelValue:a.form.isPrivate,"onUpdate:modelValue":e[3]||(e[3]=l=>a.form.isPrivate=l),size:"20"},null,8,["modelValue"])]),_:1}),a.form.isPrivate?(h(),E(w,{key:0,modelValue:a.form.password,"onUpdate:modelValue":e[4]||(e[4]=l=>a.form.password=l),name:"群組密碼",label:"群組密碼",placeholder:"請填寫群組密碼",rules:[{required:!0,message:"請填寫群組密碼"}]},null,8,["modelValue"])):$("",!0),q("div",ut,[g(c,{type:"primary",round:"",block:"","native-type":"submit"},{default:p(()=>[...e[12]||(e[12]=[C(" 送出 ",-1)])]),_:1})])]),_:1},8,["onSubmit"])])]),_:1},8,["show"])])):(h(),E(s,{key:0,class:"padding-bt-15",title:"",avatar:"","avatar-size":"50",row:6,loading:!a.group},null,8,["loading"]))])}const mt=hn(rt,[["render",lt]]);export{mt as default};
