import{m as c,h as o,n as l}from"./index-9ce14ff3.js";import{_ as n}from"./isEqual-dd5b6f94.js";import{d,e as h}from"./movie.svc-6ae5847d.js";import{m as a}from"./firebase-9126a35c.js";import"./acnh.svc-20a56244.js";import"./_getTag-5c2352f3.js";import"./isArrayLike-0dd9eb15.js";const v={data(){return{cityId:window.localStorage.getItem("cityId")||"",citys:[],theaters:[],favoriteList:[],activeTab:window.localStorage.getItem("theaters-activeTab")||"search",keyword:"",isEmpty:!1}},computed:{...c({isLoggedIn:"isLoggedIn",profile:"profile"}),filterList(){return(this.isFavorteMode?this.favoriteList:this.theaters).filter(e=>this.keyword?e.name.includes(this.keyword):!0)},cityOptions(){return this.citys.map(e=>({text:e.name,value:e.id}))},isFavorteMode(){return this.activeTab==="favorite"}},watch:{cityId:{immediate:!0,handler(e){this.getTheaterList(),window.localStorage.setItem("cityId",e)}},activeTab(e){window.localStorage.setItem("theaters-activeTab",e)},isLoggedIn:{immediate:!0,handler(e){e&&this.getFavoriteTheaters()}}},created(){a.child("citys").on("value",e=>{var i;const t=e.val();t&&((i=t.items)!=null&&i.length)&&(this.citys=t.items,this.cityId||(this.cityId=this.citys[0].id))}),this.getCityList()},beforeUnmount(){a.child("citys").off()},methods:{async getCityList(){const e=await d();e.success&&(n(this.citys,e.items)||a.child("citys").set({items:e.items,dateCreated:+o()}))},async getTheaterList(){if(!this.cityId)return;await a.child(`theaters-${this.cityId}`).once("value",t=>{const i=t.val();i&&(this.theaters=i.items)});const e=await h(this.cityId);e.success&&(n(this.theaters,e.items)||a.child(`theaters-${this.cityId}`).set({items:e.items,dateCreated:+o()}),this.theaters=e.items)},getFavoriteTheaters(){this.isLoggedIn&&(this.isEmpty=!1,a.child(`favorite-theaters-${this.profile.userId}`).once("value",e=>{const t=e.val();t&&(t!=null&&t.length)&&(this.favoriteList=t||[]),this.filterList.length||(this.isEmpty=!0)}))},async toggleFavorite(e){if(!this.isLoggedIn){this.$toast.fail("必須要登入才可以使用唷！");return}this.favoriteList.find(t=>t.id===e.id)?this.favoriteList=this.favoriteList.filter(t=>t.id!==e.id):this.favoriteList.push(e),await a.child(`favorite-theaters-${this.profile.userId}`).set(this.favoriteList),this.getFavoriteTheaters()},isFavorite(e){return!!this.favoriteList.find(t=>t.id===e.id)},goDetails(e){this.$router.push({name:"MovieTheaterDetails",params:{id:e.id},query:{cityId:this.cityId,title:e.name}})}}};var f=function(){var t=this,i=t._self._c;return i("div",{staticClass:"list__container"},[i("van-dropdown-menu",{directives:[{name:"show",rawName:"v-show",value:!t.isFavorteMode,expression:"!isFavorteMode"}],staticClass:"dropdown"},[i("van-dropdown-item",{attrs:{options:t.cityOptions,placeholder:"安安"},model:{value:t.cityId,callback:function(s){t.cityId=s},expression:"cityId"}})],1),i("van-search",{attrs:{placeholder:"請輸入關鍵字篩選"},model:{value:t.keyword,callback:function(s){t.keyword=typeof s=="string"?s.trim():s},expression:"keyword"}}),i("div",{staticClass:"list__content with-safe-area-inset-bottom"},[t._l(t.filterList,function(s){return i("van-cell",{key:s.id,attrs:{"is-link":""},on:{click:function(r){return t.goDetails(s)}}},[i("van-icon",{staticClass:"lh-inherit margin-r-10",attrs:{slot:"icon",name:t.isFavorite(s)?"like":"like-o",color:"#f48fb1"},on:{click:function(r){return r.stopPropagation(),t.toggleFavorite(s)}},slot:"icon"}),t._v(" "+t._s(s.name)+" ")],1)}),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.theaters.length&&t.cityId,expression:"!theaters.length && cityId"}]},t._l(10,function(s){return i("van-cell",{key:s},[i("van-skeleton",{attrs:{title:"",row:0}})],1)}),1),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.isFavorteMode&&!t.isLoggedIn,expression:"isFavorteMode && !isLoggedIn"}]},[i("div",{staticClass:"text-center"},[i("van-icon",{staticClass:"fs-30",attrs:{name:"warning"}}),i("div",[t._v("必須要登入才可以使用「我的最愛」唷！")])],1)]),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.isFavorteMode&&t.isEmpty,expression:"isFavorteMode && isEmpty"}]},[i("div",{staticClass:"text-center"},[i("van-icon",{staticClass:"fs-30",attrs:{name:"info"}}),i("div",[t._v("這裡還什麼都沒有")])],1)])],2),i("van-tabbar",{attrs:{fixed:"","safe-area-inset-bottom":""},model:{value:t.activeTab,callback:function(s){t.activeTab=s},expression:"activeTab"}},[i("van-tabbar-item",{attrs:{icon:"search",name:"search"}},[t._v(" 地區搜尋 ")]),i("van-tabbar-item",{attrs:{icon:"like",name:"favorite"}},[t._v(" 我的最愛 ")])],1)],1)},m=[],u=l(v,f,m,!1,null,"4e115d0b",null,null);const b=u.exports;export{b as default};
